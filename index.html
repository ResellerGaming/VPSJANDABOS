<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VPS Manager Galaxy</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    :root{--glow:#00f0ff;--purple:#9d4edd;--dark:#020111}
    *{box-sizing:border-box;font-family:'Orbitron',sans-serif}
    body{margin:0;min-height:100vh;background:var(--dark) url('https://i.ibb.co/ckLJmqm/galaxy-gif.gif') center/cover no-repeat fixed;color:#fff;overflow-x:hidden}
    @keyframes twinkle{0%,100%{opacity:.3}50%{opacity:1}}
    .stars{position:fixed;top:0;left:0;width:100%;height:100%;background:url('https://www.transparenttextures.com/patterns/stardust.png');animation:twinkle 6s infinite;pointer-events:none;z-index:0}
    h1{text-align:center;margin:1.5rem 0;font-size:2.2rem;text-shadow:0 0 10px var(--glow)}
    .container{max-width:900px;margin:auto;padding:0 1rem;position:relative;z-index:1}
    .card{background:rgba(255,255,255,.07);border:1px solid rgba(0,240,255,.25);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;backdrop-filter:blur(10px);box-shadow:0 0 20px rgba(0,240,255,.15)}
    .grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    input,select,button{width:100%;padding:.75rem 1rem;border-radius:8px;border:1px solid var(--glow);background:rgba(0,0,0,.35);color:#fff;font-size:.9rem;transition:.3s}
    input:focus,select:focus{outline:none;box-shadow:0 0 8px var(--glow)}
    button{background:linear-gradient(45deg,var(--purple),var(--glow));border:none;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px}
    button:hover{filter:brightness(1.2)}
    table{width:100%;border-collapse:collapse;margin-top:1rem;font-size:.85rem}
    th,td{padding:.6rem .5rem;text-align:center;border:1px solid rgba(0,240,255,.2)}
    th{background:rgba(0,0,0,.4);color:var(--glow)}
    .btn-del{background:transparent;border:1px solid #ff4d4d;color:#ff4d4d;padding:.3rem .6rem;border-radius:6px;cursor:pointer}
    .btn-del:hover{background:#ff4d4d;color:#fff}
    .search-box{margin-bottom:1rem;display:flex;justify-content:center}
    .search-box input{max-width:400px;border-radius:25px;padding:.6rem 1.2rem;border:1px solid var(--glow);background:rgba(0,0,0,.4);color:#fff;transition:.3s}
    .search-box input:focus{box-shadow:0 0 10px var(--glow)}
    @media (max-width:600px){h1{font-size:1.7rem}table{font-size:.75rem}}
  </style>
</head>
<body>
  <div class="stars"></div>
  <div class="container">
    <h1>🌌 VPS Manager Galaxy</h1>

    <!-- FORM INPUT -->
    <div class="card">
      <form id="vpsForm" class="grid">
        <input type="text" id="ip" placeholder="IP VPS" required/>
        <input type="text" id="username" placeholder="Username" required/>
        <input type="datetime-local" id="purchaseTime" required/>
        <input type="number" id="warrantyDays" placeholder="Garansi (hari)" required min="1"/>
        <select id="package" required>
          <option value="">Pilih Paket</option>
          <option value="1">Paket 1</option>
          <option value="2">Paket 2</option>
          <option value="3">Paket 3</option>
        </select>
        <button type="submit">Tambah VPS</button>
      </form>
    </div>

    <!-- SEARCH + TABLE -->
    <div class="card">
      <div class="search-box">
        <input type="text" id="searchIP" placeholder="🔍 Cari berdasarkan IP..." oninput="render()"/>
      </div>
      <button class="export-btn" onclick="exportJSON()">📥 Export JSON</button>
      <div style="overflow-x:auto;">
        <table id="vpsTable">
          <thead>
            <tr>
              <th>IP</th>
              <th>Username</th>
              <th>Waktu Beli</th>
              <th>Paket</th>
              <th>Garansi Habis</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    /* ---------- CONFIG (ISI SENDIRI – RISIKO BOA!) ---------- */
    const TOKEN = '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'; // PAT GitHub
    const REPO  = 'ResellerGaming/VPSJANDABOS';                      // user/repo
    const BRANCH= 'main';
    const GITHUB_API = `https://api.github.com/repos/${REPO}/contents/data_vps.json`;

    /* ---------- DATA LOKAL ---------- */
    const STORAGE_KEY = 'vpsData';
    let vpsData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    /* ---------- RENDER + FILTER ---------- */
    function render(){
      const key = document.getElementById('searchIP').value.toLowerCase();
      const filt = vpsData.filter(x=>x.ip.toLowerCase().includes(key));
      const tb = document.querySelector('#vpsTable tbody');
      tb.innerHTML = filt.length
        ? filt.map((it,ix)=>{
            const ori = vpsData.indexOf(it);
            const exp = new Date(new Date(it.purchaseTime).getTime()+it.warrantyDays*864e5);
            return `<tr>
              <td>${it.ip}</td><td>${it.username}</td><td>${new Date(it.purchaseTime).toLocaleString()}</td>
              <td>Paket ${it.package}</td><td>${exp.toLocaleDateString()}</td>
              <td><button class="btn-del" onclick="del(${ori})">Hapus</button></td>
            </tr>`;
          }).join('')
        : '<tr><td colspan="6">🌌 Kosong</td></tr>';
    }

    /* ---------- TAMBAH ---------- */
    document.getElementById('vpsForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      vpsData.push({
        ip: document.getElementById('ip').value,
        username: document.getElementById('username').value,
        purchaseTime: document.getElementById('purchaseTime').value,
        warrantyDays: parseInt(document.getElementById('warrantyDays').value),
        package: document.getElementById('package').value
      });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(vpsData));
      e.target.reset();
      render();
      await pushGitHub();
    });

    /* ---------- HAPUS ---------- */
    async function del(idx){
      if (!confirm('Hapus?')) return;
      vpsData.splice(idx,1);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(vpsData));
      render();
      await pushGitHub();
    }

    /* ---------- PUSH KE GITHUB (VIA REST) ---------- */
    async function pushGitHub(){
      try {
        // 1. ambil SHA terakhir
        const getRes = await fetch(`${GITHUB_API}?ref=${BRANCH}`);
        if (!getRes.ok) throw new Error('Gagal ambil SHA');
        const { sha } = await getRes.json();

        // 2. commit baru
        const body = {
          message: 'auto: update data_vps.json',
          content: btoa(JSON.stringify(vpsData, null, 2)),
          sha,
          branch: BRANCH
        };
        const putRes = await fetch(GITHUB_API, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${TOKEN}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });
        if (!putRes.ok) throw new Error('Gagal push');
        console.log('✅ Push sukses');
      } catch (e) {
        alert('Push gagal: ' + e.message);
        console.error(e);
      }
    }

    /* ---------- EXPORT ---------- */
    function exportJSON(){
      const blob = new Blob([JSON.stringify(vpsData, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'data_vps.json';
      a.click();
    }

    /* ---------- INIT ---------- */
    render();
  </script>
</body>
      </html>
